# 最优化 课程笔记

## 第一讲 线性规划基本原理

讲一些实际案例、背景等

## 第二讲 单纯形算法

### 一、等式形式的线性规划模型

核心：将不等式转化为带有非负右端项的等式约束

#### 松弛变量

* 为了把(<=)不等式约束转换成等式约束，在约束的左端，增加非负的**松弛变量**(slack variable)

$$
6x_1+4x_2\leq 24
$$

* 定义s1为松弛变量，约束可转换如下等式约束：

$$
6x_1+4x_2+s_1 = 24,s_1\geq 0
$$

#### 剩余变量

* 为了把(>=)不等式约束转换成等式约束，在约束的左端，减去非负的**剩余变量**(surplus variable)。

$$
3x_1+2x_2\geq 14
$$

* 定义s1为剩余变量，约束可转换如下等式约束：

$$
3x_1+2x_2-s_1 = 14,s_1\geq 0
$$

#### 非负右端项

* 让所得到的等式约束的右端项是非负的。必要时可对方程的两端乘上-1

$$
-3x_1+5x_2\leq -19
$$

约束可转换如下等式约束：
$$
-3x_1+5x_2+s_1 = -19, s_1\geq 0
$$
等式两端乘上-1，转化为非负的右端项：
$$
3x_1-5x_2-s_1 = -19
$$

### 二、图形解与代数解转换

#### 图解法

1. 画出所有约束，包括非负限制。解空间由无穷个可行点组成。
2. 识别解空间的可行角点。最优解的候选解由有限个角点给出
3. 从所有的候选点中，用目标函数确定最优的角点

#### 基变量/非基变量

从图形解到代数解的转换，(n-m)个零变量为**非基变量**，余下的m个变量为**基变量**(basic variable)，它的解称作**基本解**

### 三、单纯形方法

#### 概念与思想

* 基本思想：单纯形方法的设计要求每次增加一个变量，且选择使**z值有最大改善率**的那个变量。
* 与图形解的关系：单纯性算法的路径被定义为A->B->C。沿着路径的每个角点与一步迭代(iteration)相对应。
* 在单纯形方法中，x2为**进基变量**(enteringvariable，它进入基本可行解)，s2为**离基变量**(leaving variable，它离开基本可行解)。
* 非基变量(不在基列中)总是等于零。

#### 解法步骤

1. 确定初始基本可行解。
2. 用最优性条件选择一个进基变量。如果没有进基变量，停止计算；上一个解就是最优的。否则，转到第3步。
3. 用可行性条件选择离基变量。
4. 用适当的Gauss-Jordan行运算确定新的基本解。转到第2步。

#### 最优性与可行性条件

处理最大化和最小化问题中，最优性条件的规则正好相反，可行性条件规则一致。

* 【注】用于判断进基变量与离基变量

##### 最优性条件

在最大化(最小化)问题中，**进基变量**是z行中具有最负(最正)系数的非基变量。如有多个可任选其一。当非基变量的所有z行系数是非负的(非正的)时，迭代达到最优值。

##### 可行性条件

对于最大化和最小化问题，**离基变量**都是具有最小非负比(带有严格的正分母)的基变量。如有多个可任选其一。

#### 相关题目

见前x次作业，或Bible第1题、最后一题

### 四、改进单纯形方法

#### 改进原因

* 基本单纯形方法：所有约束是(<=)且有非负右端项的线性规划方便地提供了全部为松弛变量的初始基本可行解。包含(=)和/或(>=)约束的模型就不是如此。
* 带有(=)和(>=)约束初始“坏状态”线性规划的求解过程是使用在最初迭代中扮演松弛变量角色的人工变量，然后在稍后的迭代中恰当地处理它们。
* 【注】总的来说，目的是处理$\geq$的约束情况

#### 大M方法

##### 方法内容

大M方法以等式形式的线性规划开始。
如果第i个等式约束没有松弛变量(或能够扮演松弛变量角色的变量)，那么将人工变量Ri加入到初始解中，类似于所有松弛变量为基本解的情况。
人工变量并不是原始线性规划模型的一部分，对于这些变量，在目标函数中对它们制定非常高的惩罚，强迫它们在最优解中等于零。如果问题有可行解，这种情况总会发生。

##### 人工变量的惩罚规则

已知M为一个充分大的正数（用数学的语言描述，即$M\rightarrow \infty$ ），人工变量的目标系数表示成适当的惩罚：
人工变量的目标系数=
-M，在最大化问题中；
M，在最小化问题中；

* M的取值依赖于初始线性规划的数据。
* M相对于初始目标系数必须是**充分大**，以使得它将起到惩罚作用迫使人工变量在最优解中取值为零。
* 进行单纯形方法之前，需要将z行与表的其他部分保持一致。（**调整z行**）

{题目}实例见02讲-p81

#### 两阶段方法

##### 方法内容

阶段I 

将问题变成等式约束形式，并在约束中增加必要的人工变量，以保证找到一个初始基本解。接着求相应方程的基本解，使得无论线性规划是求极大化还是极小化，总是使人工变量之和达到最小。如果其和的最小值为正，则先行规划问题没有可行解，此过程结束。否则，进行阶段II。

阶段II 

使用阶段I得到的可行解作为原始问题的初始可行解。

{题目}见Bible第7题（最后一题）

### 五、单纯性方法的特殊情况

#### （1）退化

* 在单纯形方法可行性条件中，最小非负比可能循环出现。
* 当这种情况发生时，至少有一个基变量在下一次迭代中变为零，并称**新的解是退化的**。
* 退化解的不方便是产生循环。从实用的观点来看，此条件揭示了模型至少有一个多余的约束。

#### （2）可选择最优解

* 当目标函数平行于非冗余的紧约束（即在最优解处作为方程而被满足的约束）解，目标函数可以在多余一个解点处有相同的最优值，因此产生可选择最优解。

#### （3）无界解

* 在一些线性规划模型中，可以无限制地增加变量的值但不破坏任何一个约束，这意味着解空间至少有一个变量是无界的。
* 在此模型中，目标值可以无限制地增加（求极大值）或减少（求极小值），解空间和最优目标值都是无界的。

#### （4）不存在解

* 具有不相容约束的线性规划模型没有可行解。
* 如果所有的约束都是<=类型且具有非负的右端项，则这种情况将永远不会出现，因为松弛变量提供了一个可行解。
* （如大M、两阶段情况下）人工变量R取值为正表明问题不可行。

## 第三讲 对偶理论与灵敏度分析

### 灵敏度分析

灵敏度分析主要研究在线性规划中，模型的参数（输入数据）能够在一定的限度范围内变化而不引起最优解的改变。

#### 图形灵敏度分析

可行性区域

#### 代数灵敏度分析

略

### 对偶理论

#### 定义

对偶(dual)问题是由原始线性规划模型直接按系统化定义的一种线性规划。这两个问题有着如此紧密的关系，以至于一个问题的最优解自动地提供另一个问题的最优解。

对偶问题的定义要求将原始问题表示成等式约束形式（所有约束是等式方程，有非负的右端项，并且所有变量非负）。这与初始单纯形表的形式是一致的。因此，从原始问题最优解得到的任何结果都可以直接用到相应的对偶问题上。

#### 例子

见某次作业

## 第四讲 运输问题

### 运输问题的定义

例：某汽车制造公司有3个生产厂，分别位于洛杉矶、底特律和新奥尔良，在丹佛和迈阿密有2个主要分销中心。这3个厂一月份的生产能力分别为1000，1500，1200辆汽车。2个分销中心一月份的需求分别为2300和1400辆汽车。

负责运送这些汽车的卡车运输公司按照每辆汽车每公里8美分收取运费，每辆汽车不同路线上的费用如下表所示（单位：美元）

|          | 丹佛 | 迈阿密 |
| -------- | ---- | ------ |
| 洛杉矶   | 80   | 215    |
| 底特律   | 100  | 108    |
| 新奥尔良 | 102  | 68     |

问题的线性规划模型为：

$min \ z=80x_{11}+215x_{12}+100x_{21}+108x_{22}+102x_{31}+68x_{32}$

使得
$$
\begin{align}
x_{11}+x_{12}&=1000	\\
x_{21}+x_{22}&=1500	\\
x_{31}+x_{32}&=1200	\\
x_{11}+x_{21}+x_{31}&=2300	\\
x_{12}+x_{22}+x_{32}&=1400	\\
x_{ij}&\geq 0	\\
\end{align}
$$

### 非传统运输问题

例：某公司生产专业徒步旅行者使用的徒步套件。产品需求通常出现在每年的1至4月，该公司估计这4个月的需求量分别为100，200，180，300个。由于公司雇佣兼职人员生产徒步套件，因此每个月的生产能力都不一样。据估计，该公司从3月到6月能够生产50，180，280，270个。因为不同月份的生产能力和需求不匹配，当前月份的需求可能通过以下3种方法来满足：

（1）当月生产；

（2）以前某个月剩余的产品；

（3）以后某个月多余的产品（延期交货）。

在第1种情况下，套件的生产费用为每个40元，第2种情况下每个套件每月的储存费用为0.5元，第3种情况下每个套件每月的延期交货惩罚费为2元。该公司希望确定这4个月期间的最优生产计划

### 求初始解

运用下面3种方法可以保证找到一个初始基本解：

#### 西北角法

这个方法从表中西北角的元素开始。

* 第1步：在表中尽量选择一个最大的元素，使其相应的行和列都减去相应的选定元素的值。
* 第2步：删去零供应的行或零需求的列，即表示不可能分配给那一行或那一列。如果行和列都为零，那么仅删除一个。
* 第3步：如果恰好剩下一行或一列没有被删除，停止。否则，如果列被删除则转移到右边，如果行被删除则转移到下面，转到第1步

#### 最小费用法

最小费用法是通过寻找最小费用的路径来找到一个更好的初始解。这种方法尽量找到一个最小单位费用的单元。然后，删除满足条件的行或列，调整相应的供应和需求量。

#### Vogel（沃格尔）近似法

* 第1步
  对每一行（列）确定惩罚量：在每一行（列）中找到一个最小的单位费用单元，再在同一行（列）中找到一个次小的单位费用单元，惩罚量即为次小的单位费用减去最小的单位费用。
* 第2步
  找出惩罚量最大的行或列。尽量分配给最小单位费用的单元最多的供应量。调整供应和需求，删去已满足的行或列。如果行和列同时满足，删除二者之一。

### 求最优解

运输表计算方法，可参见第4次作业

## 第五讲 目标规划

### 建立目标规划模型

### 权和法

* 权和法：将问题中代表每个目标的函数进行加权求和以得到单个的目标函数。从目标规划所得的只是给原问题找到一个有效解，而并非最优的解。

#### 算法表述

* 假定一个目标规划模型有n个目标，并且第i个目标的形式为：

$$
min\ G_i ,i=1,2,...,n
$$

* 权和法中定义的组合目标函数可以表示为：

$$
min\ z=w_1G_1+...+w_nG_n
$$

* 其中参数wi是正的权重，反映了决策者对每个目标的相对重要性的一种量化。

### 设定优先权法

设定优先权法：首先将所有的目标按照重要性编排一个顺序，然后模型最优化的过程就是从具有最高优先级的目标开始每次只优化一个目标，并且使得对较高优先级目标求出的值不会因为求解较低目标时而减少。

## 第六讲 整数规划

### 背景

整数规划(Integer Linear Program)是要求某些或者全部的变量只取整数值（或离散值）的线性规划。

整数规划的两种经典算法：

* 分支界限法；
* 割平面法；

分类

* 纯整数线性规划：所有变量是整数变量
* 混合整数线性规划：同时包含整数和非整数变量
* 0-1型整数线性规划：所有变量只能等于0或1

### 实例应用

#### 资本预算问题

资本预算问题---研究在项目中决定是否需要进行某些投资。既要考虑投资在整个项目中带来的收益，又要考虑总预算的额度限制。

例1：在一个3年的规划周期内，有5个项目可供选择。下面的表格给出了每一个项目可以带来的期望收益以及相应每年的支出（单位为百万元）

问题可以转化成一个对于每个项目的选择为“是-否”的决策，引入二元变量xj
$$
x_j = 
\begin{cases}
1, &\text{如果选择项目j}	\\
0, &\text{如果不选择项目j}	
\end{cases}
$$
整数规划模型为
$$
max\ z = 20x_1+40x_2+20x_3+15x_4+30x_5\\
s.t.\ \
5x_1+4x_2=3x_3+7x_4+8x_5\leq 25\\
x_1+7x_2+9x_3+4x_4+6x_5<=25\\
8x_1+10x_2+2x_3+x_4+10x_5<=25\\
x_1,x_2,x_3,x_4,x_5,=(0,1)
$$

### 约束条件

1）若选择项目1就必须选择项目2；
2）项目3和项目4至少选一个；
3）项目5、6、7中选两个，如何投资使总效益最大？

* 条件1：$x_2\geq x_1$
* 条件2：$x_3+x_4\geq 1$
* 条件3：$x_5+x_6+x_7=2$

### 分支限界法

求解整数线性规划的算法大都建立在求解大规模线性规划问题的算法基础上的：
第1步
首先对整数线性规划的可行解空间进行松弛，成为一个规则的线性规划模型。
第2步
求解这个线性规划模型，并得到连续最优解。
第3步
根据得到的连续最优解，通过增加一些特殊的约束逐步改变线性规划的可行解空间，最终得到一个满足整数要求的最优极点

* 例如算出最优解x1=3.84，则分为x1<=3与x1>=4两类，分别求解

## 第七讲 动态规划

### 动态规划的递归

#### 前向递归

令fi(xi)表示阶段i到达节点xi的最短距离，定义d(xi-1,xi)为从节点xi-1到节点xi的距离，则fi是利用下面的递归关系从fi-1计算出来：
$$
f_i(x_i)=\mathop{min}\limits_\text{所有可行的$(x_{i-1},x_i)$路径}\{ d(x_{i-1},x_i)+f_{i-1}(x_{i-1}) \}
$$
从i=1开始，递归设置f0(x0)=0

#### 后向递归

$$
f_i(x_i)=\mathop{min}\limits_\text{所有可行的$(x_i,x_{i+1})$路径}\{ d(x_i,x_{})+f_{i+1}(x_{i+1}) \}
$$

* **考试时只能用后向递归做！**

### 背包模型

见作业、Bible

## 第八讲 网络优化模型

### 网络模型的基本知识

图的定义：点集V、边集 E、图G（V，E）

无向图、有向图

自回路：两端点相同的边，或称为环

多重边：两点之间多于一条一样的边

简单图：不含自回路和多重边的图

顶点的次：以点v为端点的边数称为的次，记为deg(v)，或简记为d(v)

### 最小生成树算法

最小生成树算法是用来连接一个网络的所有节点，使树上边的总长度达到最小

### 最短路径算法

#### Dijkstra算法

Dijkstra算法，可求网络中从源点到其他任何一个节点的最短路径。

* 例题可见第7次作业，一个”暂时“、”永久“列表法

#### Floyd算法

Floyd算法，可求网络中任意两个节点之间的最短路径。

* $D_0$与$S_0$的矩阵网络法

## 关于考试

第1题：单纯形/两阶段 [必考]

其余从余6题目里出

#### 单纯形表

* 阅卷时只能用单纯形法；
* 会具体看表中每一元素的值

见照片1-4

#### 西北角

* 第1、2步有对应分数；只能一种初始方法？
* n+m个基变量，数目应当同一，基本解个数搞清楚；
* 最优解由u1=0恒等，计算出其余u、v，选择(？)最大的作为进基变量改善

* 计算量不大，需细心计算；
* 依然每个表格每个元素对查、进基变量选取会检查
* 有过程分，且占比大，若结果错但查出是过程中小问题错误也会给分；仅结果正确过程不对给分低

#### 两阶段法

* 认真讲了1节课具体计算，见纸质手抄笔记

#### 对偶问题

* 变量$y_1,y_2$取值范围不受限制
* 见一道例题
* 最大化对应大于等于；最小化对应小于等于

#### 0-1整数规划

* 关于项目、资本预算问题（见第六讲）
* 注意抄对约束条件，抄错=扣分
* 会带有2-3个约束：项目x与y排斥、选a必选b等情形

#### 求最短路径

* Dijkstra

#### 后向递归

* 关于货物计算的题

#### 考试/阅卷相关

* 考题：7个题目里面挑4个
* 单纯形/两阶段必考，且占分最大
* 考题“我”出，必不可能出问题，会自己做一遍
* 题目不会太难，计算量不小
* 平均分85/86-88-89，变高的趋势
* 90+判卷严，可能不及格则手很松
* 细心检查，尽量不提前交卷

## 期末复习相关

* 见9页圣经《最优化方法七次作业解答》

